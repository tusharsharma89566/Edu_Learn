<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adaptive Assessment Dashboard - {{ user.first_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .progress-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .analytics-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .assessment-card {
            border-left: 4px solid #007bff;
            transition: transform 0.2s;
        }
        .assessment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .proficiency-badge {
            font-size: 0.8em;
            padding: 0.25rem 0.5rem;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }
        .quick-action-btn {
            border-radius: 25px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-brain me-2"></i>Adaptive Assessments
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('adaptive.take_assessment_page') }}">
                    <i class="fas fa-play me-1"></i>Take Assessment
                </a>
                <a class="nav-link" href="{{ url_for('adaptive.results_page') }}">
                    <i class="fas fa-chart-bar me-1"></i>Results
                </a>
                <a class="nav-link" href="{{ url_for('student_dashboard') }}">
                    <i class="fas fa-home me-1"></i>Dashboard
                </a>
                <a class="nav-link" href="{{ url_for('auth.logout') }}">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">
                    <i class="fas fa-graduation-cap text-primary me-2"></i>
                    Assessment Dashboard
                </h1>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-clipboard-list fa-2x mb-2"></i>
                    <h3 id="totalAssessments">0</h3>
                    <p class="mb-0">Total Assessments</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-trophy fa-2x mb-2"></i>
                    <h3 id="averageScore">0%</h3>
                    <p class="mb-0">Average Score</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-chart-line fa-2x mb-2"></i>
                    <h3 id="currentProficiency">Beginner</h3>
                    <p class="mb-0">Current Level</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-clock fa-2x mb-2"></i>
                    <h3 id="totalTime">0h</h3>
                    <p class="mb-0">Study Time</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title mb-3">
                            <i class="fas fa-bolt text-warning me-2"></i>Quick Actions
                        </h5>
                        <a href="{{ url_for('adaptive.take_assessment_page') }}" class="btn btn-primary quick-action-btn me-3">
                            <i class="fas fa-play me-2"></i>Start New Assessment
                        </a>
                        <a href="{{ url_for('adaptive.results_page') }}" class="btn btn-success quick-action-btn me-3">
                            <i class="fas fa-chart-bar me-2"></i>View Results
                        </a>
                        <button class="btn btn-info quick-action-btn" onclick="loadAnalytics()">
                            <i class="fas fa-sync-alt me-2"></i>Refresh Analytics
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Assessments -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-history text-info me-2"></i>Recent Assessments
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="recentAssessments">
                            <p class="text-muted text-center">Loading recent assessments...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Charts -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-pie text-success me-2"></i>Performance Trend
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar text-warning me-2"></i>Difficulty Progression
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="difficultyChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Analytics -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="analytics-card">
                    <h5 class="card-title">
                        <i class="fas fa-target me-2"></i>Strength Areas
                    </h5>
                    <div id="strengthAreas">
                        <p class="text-muted">Loading strength areas...</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="progress-card">
                    <h5 class="card-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Areas for Improvement
                    </h5>
                    <div id="weakAreas">
                        <p class="text-muted">Loading areas for improvement...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let performanceChart = null;
        let difficultyChart = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadQuickStats();
            loadRecentAssessments();
            loadAnalytics();
        });

        // Load quick statistics
        async function loadQuickStats() {
            try {
                const response = await fetch('/adaptive/api/quick-stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalAssessments').textContent = data.total_assessments;
                    document.getElementById('averageScore').textContent = Math.round(data.average_score) + '%';
                    document.getElementById('currentProficiency').textContent = data.current_proficiency.charAt(0).toUpperCase() + data.current_proficiency.slice(1);
                    
                    // Calculate total time (placeholder - would need to be calculated from analytics)
                    const totalTime = Math.floor(data.total_assessments * 0.5); // Assuming 30 minutes per assessment
                    document.getElementById('totalTime').textContent = totalTime + 'h';
                }
            } catch (error) {
                console.error('Error loading quick stats:', error);
            }
        }

        // Load recent assessments
        async function loadRecentAssessments() {
            try {
                const response = await fetch('/adaptive/api/quick-stats');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('recentAssessments');
                    
                    if (data.recent_assessments.length === 0) {
                        container.innerHTML = `
                            <div class="text-center">
                                <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                                <h5>No assessments yet</h5>
                                <p class="text-muted">Start your first assessment to see your progress</p>
                                <a href="{{ url_for('adaptive.take_assessment_page') }}" class="btn btn-primary">
                                    <i class="fas fa-play me-2"></i>Start Assessment
                                </a>
                            </div>
                        `;
                    } else {
                        let html = '<div class="row">';
                        data.recent_assessments.forEach(assessment => {
                            const statusColor = assessment.status === 'completed' ? 'success' : 
                                              assessment.status === 'in_progress' ? 'warning' : 'secondary';
                            const statusText = assessment.status === 'completed' ? 'Completed' : 
                                             assessment.status === 'in_progress' ? 'In Progress' : 'Abandoned';
                            
                            html += `
                                <div class="col-md-6 mb-3">
                                    <div class="card assessment-card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h6 class="card-title">${assessment.title}</h6>
                                                <span class="badge bg-${statusColor} proficiency-badge">${statusText}</span>
                                            </div>
                                            <p class="card-text small text-muted">${assessment.description || 'No description'}</p>
                                            <div class="row text-center">
                                                <div class="col-4">
                                                    <small class="text-muted">Score</small>
                                                    <div class="fw-bold">${assessment.final_score ? Math.round(assessment.final_score) + '%' : 'N/A'}</div>
                                                </div>
                                                <div class="col-4">
                                                    <small class="text-muted">Questions</small>
                                                    <div class="fw-bold">${assessment.questions_answered}/${assessment.max_questions}</div>
                                                </div>
                                                <div class="col-4">
                                                    <small class="text-muted">Time</small>
                                                    <div class="fw-bold">${assessment.time_spent_minutes}m</div>
                                                </div>
                                            </div>
                                            ${assessment.status === 'completed' ? `
                                                <div class="mt-2">
                                                    <span class="badge bg-info">${assessment.proficiency_level}</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';
                        container.innerHTML = html;
                    }
                }
            } catch (error) {
                console.error('Error loading recent assessments:', error);
            }
        }

        // Load analytics
        async function loadAnalytics() {
            try {
                const response = await fetch('/adaptive/analytics');
                const data = await response.json();
                
                if (data.success) {
                    const analytics = data.analytics;
                    
                    // Update strength and weak areas
                    updateStrengthAreas(analytics.strength_areas);
                    updateWeakAreas(analytics.weak_areas);
                    
                    // Create charts
                    createPerformanceChart(analytics);
                    createDifficultyChart(analytics.difficulty_progression);
                }
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        // Update strength areas
        function updateStrengthAreas(strengthAreas) {
            const container = document.getElementById('strengthAreas');
            
            if (!strengthAreas || strengthAreas.length === 0) {
                container.innerHTML = '<p class="text-muted">No strength areas identified yet.</p>';
                return;
            }
            
            let html = '<ul class="list-unstyled">';
            strengthAreas.forEach(area => {
                html += `
                    <li class="mb-2">
                        <i class="fas fa-check-circle me-2"></i>${area}
                    </li>
                `;
            });
            html += '</ul>';
            container.innerHTML = html;
        }

        // Update weak areas
        function updateWeakAreas(weakAreas) {
            const container = document.getElementById('weakAreas');
            
            if (!weakAreas || weakAreas.length === 0) {
                container.innerHTML = '<p class="text-muted">No areas for improvement identified yet.</p>';
                return;
            }
            
            let html = '<ul class="list-unstyled">';
            weakAreas.forEach(area => {
                html += `
                    <li class="mb-2">
                        <i class="fas fa-exclamation-circle me-2"></i>${area}
                    </li>
                `;
            });
            html += '</ul>';
            container.innerHTML = html;
        }

        // Create performance chart
        function createPerformanceChart(analytics) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            if (performanceChart) {
                performanceChart.destroy();
            }
            
            // Sample data - in real implementation, this would come from analytics
            const labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            const scores = [65, 72, 78, 85];
            
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Average Score',
                        data: scores,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Create difficulty progression chart
        function createDifficultyChart(difficultyProgression) {
            const ctx = document.getElementById('difficultyChart').getContext('2d');
            
            if (difficultyChart) {
                difficultyChart.destroy();
            }
            
            // Sample data - in real implementation, this would come from analytics
            const labels = ['Assessment 1', 'Assessment 2', 'Assessment 3', 'Assessment 4'];
            const difficulties = [0.5, 0.6, 0.7, 0.8];
            
            difficultyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Difficulty Level',
                        data: difficulties,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    if (value === 0) return 'Easy';
                                    if (value === 0.5) return 'Medium';
                                    if (value === 1) return 'Hard';
                                    return '';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
    </script>
</body>
</html> 